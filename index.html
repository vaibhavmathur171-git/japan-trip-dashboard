<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Japan Trip Planner</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#111827;
      --panel2:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#ff4d6d; /* sakura */
      --accent2:#38bdf8; /* sky */
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --border:rgba(255,255,255,.08);
    }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(255,77,109,.18), transparent 60%),
                  radial-gradient(900px 500px at 80% 10%, rgba(56,189,248,.18), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:24px;}
    header{display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;}
    h1{margin:0; font-size:22px; letter-spacing:.2px;}
    .sub{color:var(--muted); margin-top:6px; max-width:760px; line-height:1.35;}
    .pill{display:inline-flex; gap:8px; align-items:center; padding:8px 10px; border:1px solid var(--border); border-radius:999px; background:rgba(17,24,39,.65); color:var(--muted); font-size:13px;}
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:14px; margin-top:16px;}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr;} }
    .card{border:1px solid var(--border); border-radius:16px; background:linear-gradient(180deg, rgba(17,24,39,.92), rgba(15,23,42,.78)); padding:14px;}
    .card h2{margin:0 0 10px; font-size:15px; color:#fff;}
    .note{color:var(--muted); font-size:13px; line-height:1.35;}
    .opts{display:flex; flex-direction:column; gap:10px; margin-top:10px;}
    .opt{padding:12px; border:1px solid var(--border); border-radius:14px; background:rgba(17,24,39,.55);}
    .row{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;}
    .title{font-weight:700;}
    .muted{color:var(--muted);}
    .tags{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;}
    .tag{font-size:12px; color:var(--muted); border:1px solid var(--border); padding:4px 8px; border-radius:999px;}
    .kpi{display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; margin-top:10px;}
    .k{border:1px solid var(--border); background:rgba(15,23,42,.55); border-radius:14px; padding:10px;}
    .k .l{font-size:12px; color:var(--muted);} .k .v{margin-top:4px; font-size:14px; font-weight:700;}
    a{color:var(--accent2); text-decoration:none;} a:hover{text-decoration:underline;}
    .embed{border:1px dashed rgba(255,255,255,.22); border-radius:14px; padding:12px; color:var(--muted); font-size:13px;}
    .footer{margin-top:16px; color:var(--muted); font-size:12px;}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(17,24,39,.65); color:var(--text); text-decoration:none; font-size:13px;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>SFO → Japan (June/July) · 9‑day trip planner</h1>
        <div class="sub">Nonstop options to <b>Tokyo (HND/NRT)</b> and (if available nonstop) <b>Osaka (KIX)</b>. We’ll shortlist the best Friday‑to‑Sun/Mon 9‑day windows based on live airfare + weather.</div>
        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <span class="pill">Party: 4 adults + 3 kids (11, 6, 3)</span>
          <span class="pill">Depart: Friday</span>
          <span class="pill">Return: Sunday or Monday</span>
          <span class="pill">Nonstop only</span>
        </div>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-start;">
        <a class="btn" href="./data.json">View data.json</a>
        <a class="btn" href="https://www.google.com/travel/flights" target="_blank" rel="noreferrer">Google Flights</a>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>Candidate date windows</h2>
        <div class="note">Each option is Fri departure with a 9‑day trip returning Sun or Mon. Airfare shown is the lowest nonstop fare captured at lookup time (1 adult, round-trip, incl. required taxes/fees). Click through to verify live.</div>
        <div id="options" class="opts"></div>
        <div class="footer">Prices can change quickly. We’ll refresh the sweep as we narrow down.</div>
      </section>

      <aside class="card">
        <h2>Vote (upvote) + Comments</h2>
        <div class="note">Friends should be able to vote and leave questions without needing GitHub accounts. I’ll embed a simple poll + comment form here (Tally).</div>
        <div id="vote" class="embed" style="margin-top:10px;">Poll embed pending (need final form URL).</div>
        <div id="comments" class="embed" style="margin-top:10px;">Comments embed pending (need final form URL).</div>

        <h2 style="margin-top:14px;">Weather cheat sheet (Jun–Jul)</h2>
        <div class="note">
          <ul>
            <li><b>Tokyo/Osaka</b>: late Jun/early Jul often overlaps Japan’s rainy season; July tends to be hotter & more humid.</li>
            <li>We’ll add per-window indicators for heat, humidity, and rain risk to help break ties.</li>
          </ul>
        </div>
      </aside>
    </div>
  </div>

  <script>
    function fmtUsd(x){
      if (x === null || x === undefined) return '—';
      return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0}).format(x);
    }

    function bestTokyo(opt){
      const c = [];
      const hnd = opt.flights?.tokyo?.hnd;
      const nrt = opt.flights?.tokyo?.nrt;
      if (hnd && typeof hnd.priceUsd === 'number') c.push({airport:'HND', ...hnd});
      if (nrt && typeof nrt.priceUsd === 'number') c.push({airport:'NRT', ...nrt});
      if (!c.length) return null;
      c.sort((a,b)=>a.priceUsd-b.priceUsd);
      return c[0];
    }

    async function main(){
      const res = await fetch('./data.json', {cache:'no-store'});
      const data = await res.json();
      const opts = document.getElementById('options');
      opts.innerHTML = '';

      const options = (data.options || []);
      if (options.length === 0) {
        const div = document.createElement('div');
        div.className = 'opt';
        div.innerHTML = `<div class="row"><div class="title">(Working on it)</div><div class="muted">Live fare sweep pending</div></div>`;
        opts.appendChild(div);
        return;
      }

      for (const opt of options) {
        const tokyo = bestTokyo(opt);
        const kix = opt.flights?.osaka?.kix;

        const tokyoText = tokyo ? `${fmtUsd(tokyo.priceUsd)} (${tokyo.airline || ''} → ${tokyo.airport})` : '—';
        const osakaText = (kix && typeof kix.priceUsd === 'number') ? `${fmtUsd(kix.priceUsd)} (${kix.airline || ''})` : '—';
        const weatherText = opt.weather?.tokyo?.rainNote || '—';

        const div = document.createElement('div');
        div.className = 'opt';
        div.innerHTML = `
          <div class="row">
            <div class="title">${opt.departDate} → ${opt.returnDate} <span class="muted">(${opt.pattern})</span></div>
            <div class="muted">${tokyo?.link ? `<a href="${tokyo.link}" target="_blank" rel="noreferrer">Tokyo link</a>` : ''}</div>
          </div>
          <div class="kpi">
            <div class="k"><div class="l">Tokyo best (HND/NRT)</div><div class="v">${tokyoText}</div></div>
            <div class="k"><div class="l">Osaka (KIX) nonstop</div><div class="v">${(kix && kix.link) ? `<a href="${kix.link}" target="_blank" rel="noreferrer">${osakaText}</a>` : osakaText}</div></div>
            <div class="k"><div class="l">Weather note</div><div class="v">${weatherText}</div></div>
          </div>
          <div class="tags"><span class="tag">nonstop only</span><span class="tag">depart Fri</span><span class="tag">party: 4A+3K</span></div>
        `;
        opts.appendChild(div);
      }
    }
    main();
  </script>
</body>
</html>
